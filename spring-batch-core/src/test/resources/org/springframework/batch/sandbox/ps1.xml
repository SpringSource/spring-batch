<?xml version="1.0" encoding="UTF-8"?>
<!--
 * Copyright 2006-2007 the original author or authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * 
 *-->
<beans xmlns:batch="http://www.springframework.org/schema/batch"
	   xmlns="http://www.springframework.org/schema/beans"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	   xsi:schemaLocation="http://www.springframework.org/schema/beans
       		http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
       		http://www.springframework.org/schema/batch
       		http://www.springframework.org/schema/batch/spring-batch-2.1.xsd">


	<bean id="transactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
		<property name="dataSource" ref="dataSource"/>
	</bean>

	<bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource">
		<property name="driverClassName" value="org.h2.Driver"/>
		<property name="url" value="jdbc:h2:tcp://localhost/~/batch_example"/>
		<property name="username" value="sa"/>
		<property name="password" value=""/>
	</bean>

	<bean id="simplePartitioner" class="org.springframework.batch.core.partition.support.SimplePartitioner" />

	<!--
	demonstrates that we correctly ensure a reference to a step for both the default handler setup or a custom PartitionHandler 
	-->
	<bean id="taskExecutorPartitionHandler" class="org.springframework.batch.core.partition.support.TaskExecutorPartitionHandler">
    	<property name="gridSize" value="10" />
	</bean>

	<batch:job id="partitionedJob">
		<batch:step id="ss">
			<batch:partition partitioner="simplePartitioner" handler="taskExecutorPartitionHandler">

				<batch:step>
					<batch:tasklet><batch:chunk commit-interval="100" writer="writer" reader="reader"/></batch:tasklet>
				</batch:step>
				<!--<batch:handler grid-size="10" />-->
			</batch:partition>
		</batch:step>
	</batch:job>

	<batch:job-repository id="jobRepository" transaction-manager="transactionManager"/>

	<bean id="jobLauncher" class="org.springframework.batch.core.launch.support.SimpleJobLauncher">
		<property name="jobRepository" ref="jobRepository"/>
	</bean>

	<bean id="reader" class="org.springframework.batch.item.database.JdbcCursorItemReader">
		<property name="sql" value="select * from CUSTOMERS "/>
		<property name="dataSource" ref="dataSource"/>
		<property name="rowMapper">
			<bean class="org.springframework.batch.sandbox.CustomerRowMapper"/>
		</property>
	</bean>

	<bean id="writer" class="org.springframework.batch.sandbox.LoggingItemWriter"/>

</beans>
